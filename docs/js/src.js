(()=>{"use strict";var e,t={200:(e,t,n)=>{n.d(t,{Z:()=>i});class i{constructor(e,t,n,i,s,r){this._title=e,this._genres=t,this._image=n,this._runtime=i,this._summary=s,this._id=r}get htmlString(){return`<div class="show" >\n    <div class="event" id="${this._id}">\n    <a> <img src="${this._image}" /></a> \n    \n    <div><h1 id="name">${this._title}</h1></div>\n    <p class="genre">${this._genres}</p>\n    <p class="runtime">${this._runtime} min</p></div>\n    <button class ="addbtn name="addbtn">  <span>  add to your list</span></button>\n</div>\n  `}}}},n={};function i(e){var s=n[e];if(void 0!==s)return s.exports;var r=n[e]={exports:{}};return t[e](r,r.exports,i),r.exports}i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e=i(200),{showlist:[],filteredEventList:[],searchTerm:"",itemsPerPage:21,currentPage:1,setup(){window.onload=()=>{this.showLoading();const e=new URLSearchParams(window.location.search).get("page");this.currentPage=parseInt(e)||1,this.fetchEvents(),document.getElementById("searchForm").addEventListener("keyup",(()=>{let e=document.getElementById("searchInput").value;this.applyFilter(e.toLowerCase())})),document.getElementById("genre").addEventListener("click",(()=>{let e=document.getElementById("genre").value;this.genreFilter(e)})),document.getElementById("prevPageBtn").addEventListener("click",(()=>{console.log("tet"),this.changePage(this.currentPage-1)})),document.getElementById("nextPageBtn").addEventListener("click",(()=>{this.changePage(this.currentPage+1)}))}},showLoading(){let e=document.createElement("div");e.className="loading-container",e.style.position="fixed",e.style.top=0,e.style.left=0,e.style.width="100%",e.style.height="100%",e.style.display="flex",e.style.justifyContent="center",e.style.alignItems="center",e.style.backgroundColor="rgba(0, 0, 0, 0.5)",e.style.backdropFilter="blur(10px)",document.body.appendChild(e);let t=document.createElement("h2");t.textContent="Loading...",e.appendChild(t)},hideLoading(){let e=document.querySelector(".loading-container");e&&e.remove()},fetchEvents(){fetch("https://api.tvmaze.com/shows").then((e=>(this.hideLoading(),e.json()))).then((t=>{t.forEach((t=>{const n=t.name,i=t.genres,s=t.image.medium,r=t.runtime,a=t.summary,o=t.id;let l="";l=new e.Z(n,i,s,r,a,o),this.showlist.push(l),this.filteredEventList=this.showlist})),this.render(),this.InfoPage(),this.SendToList()})).catch((e=>{console.log(e),this.hideLoading();const t=document.createElement("h2");t.textContent="Failed to fetch the data",document.getElementById("eventContainer").appendChild(t)}))},render(){let e=(this.currentPage-1)*this.itemsPerPage,t=e+this.itemsPerPage,n=this.showlist.slice(e,t),i=document.getElementById("eventContainer");i.innerHTML="",n.forEach((e=>{i.innerHTML+=e.htmlString}))},changePage(e){e<1||e>Math.ceil(this.showlist.length/this.itemsPerPage)||(this.currentPage=e,this.render(),this.updateUrlWithPage(this.currentPage))},updateUrlWithPage(e){const t=new URLSearchParams(window.location.search);t.set("page",e);const n=`${window.location.pathname}?${t.toString()}`;window.history.replaceState(null,null,n)},applyFilter(e){this.searchTerm=e,document.getElementById("genre").value="";const t=this.filteredEventList.filter((t=>{if(t._title.toLowerCase().includes(e))return!0}));this.showlist=t,this.currentPage=1,this.updateUrlWithPage(this.currentPage),this.render(),this.InfoPage()},genreFilter(e){if(""==e)this.showlist=this.filteredEventList;else{const t=this.filteredEventList.filter((t=>{if(t._genres.includes(e))return!0}));this.showlist=t}this.currentPage=1,this.updateUrlWithPage(this.currentPage),this.render(),this.InfoPage()},InfoPage(){const e=document.getElementsByClassName("event");[].slice.call(e).forEach((e=>{e.addEventListener("click",(function(t){setTimeout(500),t.preventDefault();let n=e.id;console.log(n),window.location.href=`./showinfo.html?id=${n}`}))}))},SendToList(){const e=document.getElementsByClassName("addbtn");Array.from(e).forEach((e=>{e.addEventListener("click",(()=>{let t=sessionStorage.getItem("user"),n=JSON.parse(t).uuid,i={userId:t,showId:e.parentNode.firstElementChild.id,showName:e.parentNode.firstElementChild.querySelector("#name").innerText,uuid:n,showImg:e.parentNode.firstElementChild.firstElementChild.firstElementChild.src};this.getData("http://web2project.onrender.com/show","POST",i).then((e=>{let t=e.message,n=document.createElement("h2");n.innerText=t,n.id="message-popup",n.style.backgroundColor="black",document.body.appendChild(n),n.style.display="block",setTimeout((()=>{n.remove()}),3e3),sessionStorage.setItem("show",JSON.stringify(e.data))}))}))}))},async getData(e,t,n){let i=await fetch(e,{method:t,headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});return await i.json()}}.setup()})();